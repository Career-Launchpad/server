{"version":3,"sources":["../../src/login/refreshToken.js"],"names":["utils","refreshToken","configFile","readConfigFile","currentId","userId","Number","users","dashboard","expiresAt","Date","now","body","JSON","stringify","platformConfig","backendUrl","method","response","json","tokens","expires_in","idToken","id_token","accessToken","access_token","writeConfigFile","module","exports"],"mappings":";;AAAA;;;;AACA;;;;AACA;;IAAYA,K;;;;;;;;AAEZ,IAAMC;AAAA,qEAAe;AAAA;AAAA;AAAA;AAAA;AAAA;AACbC,sBADa,GACAF,MAAMG,cAAN,EADA;AAEbC,qBAFa,GAEDF,WAAWG,MAFV;;AAInB;;AAJmB,kBAKfC,OAAOJ,WAAWK,KAAX,CAAiBH,SAAjB,EAA4BI,SAA5B,CAAsCC,SAA7C,IAA0DC,KAAKC,GAAL,EAL3C;AAAA;AAAA;AAAA;;AAAA;;AAAA;AASbC,gBATa,GASNC,KAAKC,SAAL,CAAe,EAAEb,cAAcC,WAAWK,KAAX,CAAiBH,SAAjB,EAA4BI,SAA5B,CAAsCP,YAAtD,EAAf,CATM;AAAA;AAAA,mBAUI,qBAAO,GAAEc,iBAAeC,UAAW,gBAAnC,EAAoD;AACzEC,sBAAQ,MADiE;AAEzEL;AAFyE,aAApD,CAVJ;;AAAA;AAUbM,oBAVa;AAAA;AAAA,mBAeEA,SAASC,IAAT,EAfF;;AAAA;AAebC,kBAfa;AAgBbX,qBAhBa,GAgBDW,OAAOC,UAAP,GAAoB,IAApB,GAA2BX,KAAKC,GAAL,EAhB1B;;AAiBnBT,uBAAWK,KAAX,CAAiBH,SAAjB,EAA4BI,SAA5B,CAAsCc,OAAtC,GAAgDF,OAAOG,QAAvD;AACArB,uBAAWK,KAAX,CAAiBH,SAAjB,EAA4BI,SAA5B,CAAsCgB,WAAtC,GAAoDJ,OAAOK,YAA3D;AACAvB,uBAAWK,KAAX,CAAiBH,SAAjB,EAA4BI,SAA5B,CAAsCC,SAAtC,GAAkDA,SAAlD;AACAT,kBAAM0B,eAAN,CAAsBxB,UAAtB;;AApBmB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAAf;;AAAA;AAAA;AAAA;AAAA,GAAN;;AAuBAyB,OAAOC,OAAP,GAAiB3B,YAAjB","file":"refreshToken.js","sourcesContent":["import fetch from '../fetch'\nimport platformConfig from '../config'\nimport * as utils from '../utils'\n\nconst refreshToken = async () => {\n  const configFile = utils.readConfigFile()\n  const currentId = configFile.userId\n\n  // id token not expired, no need to renew\n  if (Number(configFile.users[currentId].dashboard.expiresAt) > Date.now()) {\n    return\n  }\n\n  const body = JSON.stringify({ refreshToken: configFile.users[currentId].dashboard.refreshToken })\n  const response = await fetch(`${platformConfig.backendUrl}tokens/refresh`, {\n    method: 'POST',\n    body\n  })\n\n  const tokens = await response.json()\n  const expiresAt = tokens.expires_in * 1000 + Date.now()\n  configFile.users[currentId].dashboard.idToken = tokens.id_token\n  configFile.users[currentId].dashboard.accessToken = tokens.access_token\n  configFile.users[currentId].dashboard.expiresAt = expiresAt\n  utils.writeConfigFile(configFile)\n}\n\nmodule.exports = refreshToken\n"]}