language: node_js
sudo: false
matrix:
  include:
  - node_js: 6
  - node_js: 8
  - node_js: '10.15'
install:
- npm install -g npm codecov
# allows for bumping sdk version before matching sdk version is released
- node ./scripts/updatePreReleaseDependency.js
- npm install
- pushd sdk-js && npm install && popd
script:
- npm run lint
- pushd sdk-js && npm run lint && popd
- npm run test
- "if [ z$TRAVIS_NODE_VERSION == z10.15 ] && [ z$SERVERLESS_ACCESS_KEY != z ]; then npm run integration-test ; else echo skipping node $TRAVIS_NODE_VERSION ; fi"
- pushd sdk-js && npm run test && popd
- codecov
- npm run build
before_deploy:
- git checkout package.json
- node ./scripts/updatePreReleaseVersion.js
- '[[ "$TRAVIS_TAG" =~ beta ]] || [[ -z "$TRAVIS_TAG" ]] && node ./scripts/updatePreReleaseDependency.js || true'
deploy:
  # production releases
  - provider: npm
    email: services@serverless.com
    skip_cleanup: true
    tag: latest
    on:
      node: 10.15
      tags: true
      condition: '! "$TRAVIS_TAG" =~ beta'
      repo: serverless/enterprise-plugin
    api_key:
      secure: Le1nHuG1/67k89s+DNC+laOAZLHLqviDBi9j8hXNH4qIGkEgJw5aXc621q/Vo3eObavEV9P3zV9/b8Fry9WDzXiq046zYhP7IdNkgmQTh/rKyyw6fJNM8Nqp79Hvoe3B/zpHExDlHAT0OoZog0MG57PGQER5v9B/QGwMhjmT5ABLXvukjPS1Huo8YGFZy7hvK70Rfz9EDVRXmolXA8//tmIeqNkfuCLcIbJL0RA7K/kMXeaQ5ppm2JtvyU8z6kvwI1D8S30Wc62iagBIxfqh0hO1Rsf6Q8Lbvd1VXJsGM/96INPCBdcMzrvcyorzDAhcTts3ucXP7OAMlzONultO/6Z71yxvwOPnm33+bUTYvL/l1xBxDIaWsO6S/g27PJfOza66ZYHNV+vDsVANMj8GASQij+kswWuLbHciXVHBaL4i0QGkXSz3lIPUySGc99WUAreZZDk21LYS2jFbpMJDNe+/vLzqfNGcO9hMuq66RHdUlgD3YTFimQIWSYwibWDLelUUsHGe5JOB8zjRPBA9KuWDK8ilBGgzGtcugAlGUuKl1eBs5QQeA8MPtIiTVWAzdID7boCzmLFyTp51layCkICUKH3Zn3zkmhjp3h62lfGuT2tyAfmFUGK+KUMlb4Sw8z93KEG2n+ZFZSpbKgCqMwe3cF3pK/2Yr1csY/GHAgs=
  # tagged prereleases
  - provider: npm
    email: services@serverless.com
    skip_cleanup: true
    tag: next
    on:
      node: 10.15
      tags: true
      condition: '"$TRAVIS_TAG" =~ beta'
      repo: serverless/enterprise-plugin
    api_key:
      secure: Le1nHuG1/67k89s+DNC+laOAZLHLqviDBi9j8hXNH4qIGkEgJw5aXc621q/Vo3eObavEV9P3zV9/b8Fry9WDzXiq046zYhP7IdNkgmQTh/rKyyw6fJNM8Nqp79Hvoe3B/zpHExDlHAT0OoZog0MG57PGQER5v9B/QGwMhjmT5ABLXvukjPS1Huo8YGFZy7hvK70Rfz9EDVRXmolXA8//tmIeqNkfuCLcIbJL0RA7K/kMXeaQ5ppm2JtvyU8z6kvwI1D8S30Wc62iagBIxfqh0hO1Rsf6Q8Lbvd1VXJsGM/96INPCBdcMzrvcyorzDAhcTts3ucXP7OAMlzONultO/6Z71yxvwOPnm33+bUTYvL/l1xBxDIaWsO6S/g27PJfOza66ZYHNV+vDsVANMj8GASQij+kswWuLbHciXVHBaL4i0QGkXSz3lIPUySGc99WUAreZZDk21LYS2jFbpMJDNe+/vLzqfNGcO9hMuq66RHdUlgD3YTFimQIWSYwibWDLelUUsHGe5JOB8zjRPBA9KuWDK8ilBGgzGtcugAlGUuKl1eBs5QQeA8MPtIiTVWAzdID7boCzmLFyTp51layCkICUKH3Zn3zkmhjp3h62lfGuT2tyAfmFUGK+KUMlb4Sw8z93KEG2n+ZFZSpbKgCqMwe3cF3pK/2Yr1csY/GHAgs=
  # automatic prereleases
  - provider: npm
    email: services@serverless.com
    skip_cleanup: true
    tag: next
    on:
      node: 10.15
      tags: false
      branch: master
      repo: serverless/enterprise-plugin
    api_key:
      secure: Le1nHuG1/67k89s+DNC+laOAZLHLqviDBi9j8hXNH4qIGkEgJw5aXc621q/Vo3eObavEV9P3zV9/b8Fry9WDzXiq046zYhP7IdNkgmQTh/rKyyw6fJNM8Nqp79Hvoe3B/zpHExDlHAT0OoZog0MG57PGQER5v9B/QGwMhjmT5ABLXvukjPS1Huo8YGFZy7hvK70Rfz9EDVRXmolXA8//tmIeqNkfuCLcIbJL0RA7K/kMXeaQ5ppm2JtvyU8z6kvwI1D8S30Wc62iagBIxfqh0hO1Rsf6Q8Lbvd1VXJsGM/96INPCBdcMzrvcyorzDAhcTts3ucXP7OAMlzONultO/6Z71yxvwOPnm33+bUTYvL/l1xBxDIaWsO6S/g27PJfOza66ZYHNV+vDsVANMj8GASQij+kswWuLbHciXVHBaL4i0QGkXSz3lIPUySGc99WUAreZZDk21LYS2jFbpMJDNe+/vLzqfNGcO9hMuq66RHdUlgD3YTFimQIWSYwibWDLelUUsHGe5JOB8zjRPBA9KuWDK8ilBGgzGtcugAlGUuKl1eBs5QQeA8MPtIiTVWAzdID7boCzmLFyTp51layCkICUKH3Zn3zkmhjp3h62lfGuT2tyAfmFUGK+KUMlb4Sw8z93KEG2n+ZFZSpbKgCqMwe3cF3pK/2Yr1csY/GHAgs=
env:
  global:
    # SERVERLESS_ACCESS_KEY
    secure: WAwePU+QdsesOqOiXwE+7QQj3tzB8uwZDW1ZGQoOCK3aFKr/ByOJX3bSAqIUAJc44O1YyP/7tSY5K7WNU/1+12tMmQDbw64SFdWYZT0k0qIkQMXcXlmSMb+VimjXQGTl3IWJMbv4hMofCr5X80/hoCbasTg85+TueXwgqi2ItrGJ0rP/W3/TTx0zyLWQWXBP2Fbj4SeErg1sXP/kB4c4aS1wyocJ+ReSW4e/FKvMJS28wdCSKSOLZ0BPkaPaTYtreJAaJCedK4kffh+jm8RaZ6ocODcziEzeSQiSbspjM2tuHyd6L1kuWpAAw+lELFZ6N1kwTUWRcqNOqIdv09fv80tNAUjHeGIhsIUHJDmiB7MIDVV4FI/hgyD9BmJVisCSMB5NrMTKeJsOXUZyEIBMZpUvunSsopSY9E1RZI8N8Nn9tmL687Z0Ff6IJnMvej6eD98sdLSaQyhtJlRGAbaOBK9gKwDftgeIdgjA5eUAQVYQ67N+Bq1OCJ1MaJWvEK2hbU7xIQTAvwgApdoX7x0uKeOYs6lM46CdDDplhgpaSOI+2fg1EfellRwOBC6E6OCR9jMt5e+hULuLFqHY17L0n8wTTDTGhd5SFgnglkI6he53PbB1zmN8IUgSGe3E//q3MZ/CWcxo3JElzAvJj0Qc/uJIBZOmA/9YmP3u+Crq+4Q=
